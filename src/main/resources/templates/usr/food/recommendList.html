<html layout:decorate="~{common/layout/defaultLayout.html}" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>영양소 명세 리스트</title>
</head>

<body>
<div layout:fragment="Content">

    <div>
        <div class="mt-10 ml-10 flex">
            <h3 class="text-gray-400 font-bold bolder-none my-2 mb-0.5">영양소 목록</h3>
        </div>
        <div class="flex flex-wrap justify-center items-center mt-3 ml-10 mr-10 py-3 bg-gray-300 rounded-lg h-auto">

            <input type="radio" name="nutritionType" value="carbohydrate"
                   class="radio radio ml-10 checked:bg-yellow-500"/>
            <label class="text-black ml-2 whitespace-nowrap">탄수화물</label>

            <input type="radio" name="nutritionType" value="protein"
                   class="radio radio ml-10 checked:bg-yellow-500"/>
            <label class="text-black ml-2 whitespace-nowrap">단백질</label>

            <input type="radio" name="nutritionType" value="fat"
                   class="radio radio ml-10 checked:bg-yellow-500"/>
            <label class="text-black ml-2 whitespace-nowrap">지방</label>

            <input type="radio" name="nutritionType" value="calcium"
                   class="radio radio ml-10 checked:bg-yellow-500"/>
            <label class="text-black ml-2 whitespace-nowrap">칼슘</label>

            <input type="radio" name="nutritionType" value="sodium"
                   class="radio radio ml-10 checked:bg-yellow-500"/>
            <label class="text-black ml-2 whitespace-nowrap">나트륨</label>

            <input type="radio" name="nutritionType" value="potassium"
                   class="radio radio ml-10 checked:bg-yellow-500"/>
            <label class="text-black ml-2 whitespace-nowrap">칼륨</label>

            <input type="radio" name="nutritionType" value="vitaminA"
                   class="radio radio ml-10 checked:bg-yellow-500"/>
            <label class="text-black ml-2 whitespace-nowrap">비타민A</label>

            <input type="radio" name="nutritionType" value="vitaminC"
                   class="radio radio ml-10 checked:bg-yellow-500"/>
            <label class="text-black ml-2 whitespace-nowrap mr-10">비타민C</label>
        </div>

        <form method="post" th:action="@{/recommend/img}" enctype="multipart/form-data">
            <input id="img" name="img" type="file" class="file-input file-input-bordered file-input ml-10"/>
            <button type="submit" class="btn btn-warning">(임시) 이미지업로드</button>
        </form>

    </div>

    <div id="resultDiv" class="w-full h-full bg-gray-300 rounded-lg">
        <!-- 선택된 영양소에 따라 다른 내용 출력 -->
    </div>

    <script th:inline="javascript">
        // 선택된 라디오 버튼의 변경 이벤트를 감지
        const radioButtons = document.getElementsByName("nutritionType");
        radioButtons.forEach(function (radioButton) {
            radioButton.addEventListener("change", function () {
                // 선택된 값 가져오기
                const selectedValue = document.querySelector('input[name="nutritionType"]:checked').value;
                const csrfToken = /*[[${_csrf.token}]]*/ ''; // CSRF 토큰 값을 가져옵니다

                // AJAX 요청 데이터 구성
                const requestData = {
                    selectedValue: selectedValue,
                    _csrf: csrfToken
                };

                $.ajax({
                    url: "/recommend/list",
                    type: "POST",
                    data: requestData,
                    success: function (data) {
                        // JSON 형식의 응답 데이터를 객체로 파싱
                        const response = data;
                        // 결과를 HTML로 구성하여 출력
                        const resultDiv = document.getElementById("resultDiv");
                        resultDiv.innerHTML = `
                    <div class="w-full h-full bg-gray-300 rounded-lg">
                        <h1 class="font-black">${response.nutritionName}</h1>
                        <h1 class="font-black">${response.nutritionDescription}</h1>
                        <h1 class="font-black">${response.nutritionFoodList.join(', ')}</h1>
                    </div>
                `;
                    },
                    error: function () {
                        alert("데이터 통신 중 에러 발생");
                    }
                })
            });
        });
    </script>

</div>
</body>